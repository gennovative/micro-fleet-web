{"version":3,"sources":["app/RestCRUDControllerBase.ts"],"names":[],"mappings":"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","file":"RestCRUDControllerBase.js","sourcesContent":["import * as express from 'express';\r\nimport { decorate } from 'inversify';\r\nimport * as TrailsApp from 'trails';\r\nimport TrailsController = require('trails-controller');\r\n\r\nimport { injectable, inject, unmanaged, Guard, HandlerContainer } from 'back-lib-common-util';\r\nimport {\r\n\tSettingItem, SettingItemDataType, ISoftDelRepository,\r\n\tModelAutoMapper, JoiModelValidator, PagedArray\r\n} from 'back-lib-common-contracts';\r\n\r\nimport { RestControllerBase, TrailsRouteConfigItem } from './RestControllerBase';\r\nimport { TenantResolver } from './TenantResolver';\r\n\r\n\r\n@injectable()\r\nexport abstract class RestCRUDControllerBase<TModel extends IModelDTO> \r\n\textends RestControllerBase {\r\n\r\n\r\n\t/**\r\n\t * Generates Trails routes for CRUD operations.\r\n\t * @param {string} controllerDepIdentifier Key to look up and resolve from dependency container.\r\n\t * @param {boolean} isSoftDel Whether to add endpoints for `deleteSoft` and `recover`.\r\n\t * @param {string} pathPrefix Path prefix with heading slash and without trailing slash. Eg: /api/v1\r\n\t */\r\n\tpublic static createRoutes(controllerDepIdentifier: string, isSoftDel: boolean, pathPrefix: string = ''): TrailsRouteConfigItem[] {\r\n\t\tlet container = HandlerContainer.instance,\r\n\t\t\tgenFn = (method, action) => {\r\n\t\t\t\treturn RestControllerBase.createRoute(method, action,\r\n\t\t\t\t\tcontrollerDepIdentifier, pathPrefix, container);\r\n\t\t\t};\r\n\r\n\t\tlet routes = [\r\n\t\t\tgenFn('GET', ''),\r\n\t\t\tgenFn('POST', ''),\r\n\t\t\tgenFn('PUT', ''),\r\n\t\t\tgenFn('PATCH', ''),\r\n\t\t\tgenFn('DELETE', ''),\r\n\t\t\tgenFn('GET', 'countAll'),\r\n\t\t\tgenFn('GET', 'exists'),\r\n\t\t\tgenFn('GET', 'findByPk'),\r\n\t\t];\r\n\r\n\t\tisSoftDel && routes.push(\r\n\t\t\tgenFn('GET', 'recover')\r\n\t\t);\r\n\r\n\t\treturn routes;\r\n\t}\r\n\r\n\r\n\tconstructor(\r\n\t\t@unmanaged() trailsApp: TrailsApp,\r\n\t\t@unmanaged() protected _tenantResolver: TenantResolver,\r\n\t\t@unmanaged() protected _ClassDTO?: { new(): TModel },\r\n\t\t@unmanaged() protected _repo?: ISoftDelRepository<TModel, any, any>,\r\n\t) {\r\n\t\tsuper(trailsApp);\r\n\t}\r\n\r\n\tprotected get validator(): JoiModelValidator<TModel> {\r\n\t\treturn this._ClassDTO['validator'];\r\n\t}\r\n\r\n\tprotected get translator(): ModelAutoMapper<TModel> {\r\n\t\treturn this._ClassDTO['translator'];\r\n\t}\r\n\r\n\tprivate resolveTenant(tenantSlug: string) {\r\n\t\t// this._cache.\r\n\t}\r\n\r\n\tpublic async countAll(req: express.Request, res: express.Response) {\r\n\t\tconsole.log('Counting model');\r\n\t\tlet payload = req.query;\r\n\t\ttry {\r\n\t\t\tlet nRows: number = await this._repo.countAll({\r\n\t\t\t\ttenantId: req.params.tenant\r\n\t\t\t});\r\n\t\t\tthis.ok(res, nRows);\r\n\t\t} catch (err) {\r\n\t\t\tthis.internalError(res, err);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async create(req: express.Request, res: express.Response) {\r\n\t\tconsole.log('Creating model');\r\n\t\tlet payload = req.body(),\r\n\t\t\tdto: TModel = this.translator.whole(payload.model, {\r\n\t\t\t\terrorCallback: details => this.validationError(res, details)\r\n\t\t\t});\r\n\t\tif (!dto) { return; }\r\n\r\n\t\ttry {\r\n\t\t\tdto = await this._repo.create(dto, payload.options);\r\n\t\t\tthis.created(res, dto);\r\n\t\t} catch (err) {\r\n\t\t\tthis.internalError(res, err);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async deleteHard(req: express.Request, res: express.Response) {\r\n\t\tconsole.log('Hard deleting model');\r\n\t\tlet payload = req.body(),\r\n\t\t\t[err, pk] = this.validator.pk(payload.pk);\r\n\t\tif (!err) {\r\n\t\t\tthis.validationError(res, err);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tlet nRows: number = await this._repo.deleteHard(pk, payload.options);\r\n\t\t\tthis.ok(res, nRows);\r\n\t\t} catch (err) {\r\n\t\t\tthis.internalError(res, err);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async deleteSoft(req: express.Request, res: express.Response) {\r\n\t\tconsole.log('Soft deleting model');\r\n\t\tlet payload = req.body(),\r\n\t\t\t[err, pk] = this.validator.pk(payload.pk);\r\n\t\tif (!err) {\r\n\t\t\tthis.validationError(res, err);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tlet nRows: number = await this._repo.deleteSoft(pk, payload.options);\r\n\t\t\tthis.ok(res, nRows);\r\n\t\t} catch (err) {\r\n\t\t\tthis.internalError(res, err);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async exists(req: express.Request, res: express.Response) {\r\n\t\tconsole.log('Checking existence');\r\n\t\tlet payload = req.body();\r\n\t\ttry {\r\n\t\t\tlet gotIt: boolean = await this._repo.exists(payload.props, payload.options);\r\n\t\t\tthis.ok(res, gotIt);\r\n\t\t} catch (err) {\r\n\t\t\tthis.internalError(res, err);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async findByPk(req: express.Request, res: express.Response) {\r\n\t\tconsole.log('Finding model');\r\n\t\tlet payload = req.body(),\r\n\t\t\t[err, pk] = this.validator.pk(payload.pk);\r\n\t\tif (!err) {\r\n\t\t\tthis.validationError(res, err);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tlet dto: TModel = await this._repo.findByPk(pk, payload.options);\r\n\t\t\tthis.ok(res, dto);\r\n\t\t} catch (err) {\r\n\t\t\tthis.internalError(res, err);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async recover(req: express.Request, res: express.Response) {\r\n\t\tconsole.log('Recovering model');\r\n\t\tlet payload = req.body(),\r\n\t\t\t[err, pk] = this.validator.pk(payload.pk);\r\n\t\tif (!err) {\r\n\t\t\tthis.validationError(res, err);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tlet nRows: number = await this._repo.recover(pk, payload.options);\r\n\t\t\tthis.ok(res, nRows);\r\n\t\t} catch (err) {\r\n\t\t\tthis.internalError(res, err);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async page(req: express.Request, res: express.Response) {\r\n\t\tconsole.log('Paging model');\r\n\t\tlet payload = req.body();\r\n\t\ttry {\r\n\t\t\tlet models: PagedArray<TModel> = await this._repo.page(payload.pageIndex, payload.pageSize, payload.options);\r\n\t\t\tthis.ok(res, models);\r\n\t\t} catch (err) {\r\n\t\t\tthis.internalError(res, err);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async patch(req: express.Request, res: express.Response) {\r\n\t\tconsole.log('Patching model');\r\n\t\tlet payload = req.body(),\r\n\t\t\tmodel = this.translator.partial(payload.model, {\r\n\t\t\t\terrorCallback: err => this.validationError(res, err)\r\n\t\t\t});\r\n\t\tif (!model) { return; }\r\n\r\n\t\ttry {\r\n\t\t\tlet updatedProps: Partial<TModel> = await this._repo.patch(model, payload.options);\r\n\t\t\tthis.ok(res, updatedProps);\r\n\t\t} catch (err) {\r\n\t\t\tthis.internalError(res, err);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async update(req: express.Request, res: express.Response) {\r\n\t\tconsole.log('Updating model');\r\n\t\tlet payload = req.body(),\r\n\t\t\tmodel: TModel = this.translator.whole(payload.model, {\r\n\t\t\t\terrorCallback: err => this.validationError(res, err)\r\n\t\t\t});\r\n\t\tif (!model) { return; }\r\n\r\n\t\ttry {\r\n\t\t\tlet updatedModel: TModel = await this._repo.update(model, payload.options);\r\n\t\t\tthis.ok(res, updatedModel);\r\n\t\t} catch (err) {\r\n\t\t\tthis.internalError(res, err);\r\n\t\t}\r\n\t}\r\n}"]}