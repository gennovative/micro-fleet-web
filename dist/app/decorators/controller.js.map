{"version":3,"sources":["app/decorators/controller.ts"],"names":[],"mappings":";AAAA,0CAA0C;;AAE1C,+DAAsF;AAEtF,oDAAiD;AAOjD;;;;;GAKG;AACH,oBAA2B,OAAe,EAAE;IAC3C,MAAM,CAAC,UAAU,WAAqB;QACrC,EAAE,CAAC,CAAC,OAAO,CAAC,cAAc,CAAC,mBAAQ,CAAC,UAAU,EAAE,WAAW,CAAC,CAAC,CAAC,CAAC;YAC9D,MAAM,IAAI,wCAAiB,CAAC,gCAAgC,CAAC,CAAC;QAC/D,CAAC;QAED,EAAE,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,CAAC,CAAC;YAClB,IAAI,GAAG,EAAE,CAAC;QACX,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,IAAI,GAAG,CAAC,CAAC,CAAC;YACxB,qCAAqC;YACrC,wDAAwD;YACxD,IAAI,GAAG,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;YACpD,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,gBAAgB;YAClE,4BAAK,CAAC,eAAe,CAAC,IAAI,EAAE,0CAA0C,CAAC,CAAC;QACzE,CAAC;QAAC,IAAI,CAAC,CAAC;YACP,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;gBAC/C,oBAAoB;gBACpB,IAAI,GAAG,GAAG,GAAG,IAAI,CAAC;YACnB,CAAC;YACD,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;gBACxB,wBAAwB;gBACxB,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;YACxC,CAAC;QACF,CAAC;QAED,OAAO,CAAC,cAAc,CAAC,mBAAQ,CAAC,UAAU,EAAE,CAAC,IAAI,CAAC,EAAE,WAAW,CAAC,CAAC;QAEjE,MAAM,CAAC,WAAW,CAAC;IACpB,CAAC,CAAC;AACH,CAAC;AA7BD,gCA6BC","file":"controller.js","sourcesContent":["/// <reference types=\"reflect-metadata\" />\r\n\r\nimport { IDependencyContainer, CriticalException, Guard } from 'back-lib-common-util';\r\n\r\nimport { MetaData } from '../constants/MetaData';\r\nimport { serverContext } from '../ServerContext';\r\n\r\n\r\nexport type ControllerDecorator = (path?: string) => Function;\r\n\r\n\r\n/**\r\n * Used to decorate REST controller class.\r\n * @param {string} path Segment of URL pointing to this controller.\r\n * \t\tIf '_' is given, it is extract from controller class name: {path}Controller.\r\n * \t\tIf not specified, it is default to be empty string.\r\n */\r\nexport function controller(path: string = ''): Function {\r\n\treturn function (targetClass: Function): Function {\r\n\t\tif (Reflect.hasOwnMetadata(MetaData.CONTROLLER, targetClass)) {\r\n\t\t\tthrow new CriticalException('Duplicate controller decorator');\r\n\t\t}\r\n\r\n\t\tif (path == null) {\r\n\t\t\tpath = '';\r\n\t\t} else if (path == '_') {\r\n\t\t\t// Extract path from controller name.\r\n\t\t\t// Only if controller name is in format {xxx}Controller.\r\n\t\t\tpath = targetClass.name.match(/(.+)Controller$/)[1];\r\n\t\t\tpath = path[0].toLowerCase() + path.substring(1); // to camel case\r\n\t\t\tGuard.assertIsDefined(path, 'Cannot extract path from controller name');\r\n\t\t} else {\r\n\t\t\tif (path.length >= 1 && !path.startsWith('/')) {\r\n\t\t\t\t// Add heading slash\r\n\t\t\t\tpath = '/' + path;\r\n\t\t\t}\r\n\t\t\tif (path.endsWith('/')) {\r\n\t\t\t\t// Remove trailing slash\r\n\t\t\t\tpath = path.substr(0, path.length - 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tReflect.defineMetadata(MetaData.CONTROLLER, [path], targetClass);\r\n\r\n\t\treturn targetClass;\r\n\t};\r\n}"]}